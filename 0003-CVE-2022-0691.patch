From b2201c00e9bf7cd65e2d711a4e089f55de80359a Mon Sep 17 00:00:00 2001
From: Seal <info@sealsecurity.io>
Date: Tue, 25 Jun 2024 10:06:54 +0300
Subject: [PATCH] CVE-2022-0691

---
 index.js     |  5 ++---
 test/test.js | 12 ++++++++++++
 2 files changed, 14 insertions(+), 3 deletions(-)

diff --git a/index.js b/index.js
index 9bbd099..98ce5ab 100644
--- a/index.js
+++ b/index.js
@@ -4,8 +4,7 @@ var required = require('requires-port')
   , qs = require('querystringify')
   , slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\/\//
   , protocolre = /^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i
-  , whitespace = '[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]'
-  , left = new RegExp('^'+ whitespace +'+');
+  , whitespace = /^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/

 /**
  * Trim a given string.
@@ -14,7 +13,7 @@ var required = require('requires-port')
  * @public
  */
 function trimLeft(str) {
-  return (str ? str : '').toString().replace(left, '');
+  return (str ? str : '').toString().replace(whitespace, '');
 }

 /**
diff --git a/test/test.js b/test/test.js
index 23a5a87..5443e76 100644
--- a/test/test.js
+++ b/test/test.js
@@ -65,6 +65,18 @@ describe('url-parse', function () {
       assume(parse.trimLeft(fake)).equals('wat');
     });
   });
+
+  describe('trimLeft', function () {
+    it('removes control characters on the left', function () {
+      var i = 0;
+      var prefix = ''
+
+      for (; i < 33; i++) {
+        prefix = String.fromCharCode(i);
+        assume(parse.trimLeft(prefix + prefix + 'lol')).equals('lol');
+      }
+    });
+  });

   describe('extractProtocol', function () {
     it('extracts the protocol data', function () {
--
2.39.3
